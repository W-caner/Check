import{aj as e,ah as t,ao as a,ag as s,G as l,O as i,q as o,H as r,aI as d,aX as n,aJ as m,N as u}from"./@vue.c261c184.js";import{a as h}from"./vue-router.f985018f.js";import{w as p}from"./element-plus.d6772035.js";import"./resize-observer-polyfill.96acbc9d.js";import"./lodash.c042e748.js";import"./axios.df2521e5.js";import"./normalize-wheel.86fce3c7.js";import"./mitt.20cc8481.js";import"./dayjs.1c7a45b9.js";import"./async-validator.3a3a8ce1.js";import"./@popperjs.59bfb2c1.js";const c={name:"MGroup",path:"/manage/:id",inject:["reload"],data:()=>({memberVisible:!1,route:h(),groupName:"",groupID:"",taskList:[],memberList:[],Mem:{userid:"",memname:""},taskVisible:!1,taskInfo:{name:"",mode:"",time:"",text:""},nameVisible:!1,memName:"",edit3:!1,rule:{name:[{required:!0,trigger:"blur",message:"请输入任务名称"}],mode:[{required:!0,trigger:"blur",message:"请选择任务模式"}],text:[{required:!0,trigger:"blur",message:"请输入所需识别文字"}],time:[{required:!0,trigger:"blur",message:"请输入任务时间"}]},currentPage:1,totalCount:1}),mounted(){this.groupID=this.route.params.id,this.$axios.get("http://localhost:9000/manage/getName",{params:{id:this.route.params.id}}).then((e=>{null!==e.data&&(this.groupName=e.data)})).catch((e=>{this.$message.error("出错了！"),console.log(e)})),this.$axios.get("http://localhost:9000/manage/getTask",{params:{id:this.route.params.id}}).then((e=>{if(null!==e.data){this.taskList=[];for(let t=0;t<e.data.length;t++)this.taskList.push(e.data[t]);this.totalCount=e.data.length}})).catch((e=>{this.$message.error("出错了！"),console.log(e)}))},watch:{$route(){this.reload()}},methods:{handleSizeChange(e){this.pageSize=e,this.currentPage=1},handlecurrentChange(e){this.currentPage=e},FormatTime(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},altername(){this.$axios.get("http://localhost:9000/manage/altername",{params:{userid:localStorage.getItem("userId"),id:this.route.params.id}}).then((e=>{this.memName=e.data})).catch((e=>{this.$message.error("出错了！"),console.log(e)})),this.nameVisible=!0},alter(){""!==this.memName?this.$axios.post("http://localhost:9000/manage/alter",{memname:this.memName,groupid:this.route.params.id,userid:localStorage.getItem("userId")}).then((e=>{"success"===e.data?p.success("成功修改名称"):p.error("修改名称出错")})).catch((e=>{this.$message.error("出错了！"),console.log(e)})):p.error("群内昵称不能为空")},addTask(){this.taskVisible=!0},member(){this.$axios.get("http://localhost:9000/manage/getMember",{params:{id:this.route.params.id}}).then((e=>{if(null!==e.data){this.memberList=[];for(let t=0;t<e.data.length;t++)this.memberList.push(e.data[t])}})).catch((e=>{this.$message.error("出错了！"),console.log(e)})),this.memberVisible=!0},addMan(){this.$prompt("请输入要添加管理员的id(电话)","创建管理员",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^1[3-9]\d{9}$/,inputErrorMessage:"管理员id格式不正确"}).then((({value:e})=>{this.$axios.post("http://localhost:9000/manage/addManager",{userid:e,groupid:this.route.params.id}).then((e=>{"success"===e.data&&(this.$message({type:"success",message:"添加管理员成功"}),this.reload())})).catch((e=>{p.error("出错了"),console.log(e)}))})).catch((()=>{this.$message.error("添加管理员失败")}))},onSubmit(){var e="";e="3"===this.taskInfo.mode?this.taskInfo.text:this.taskInfo.mode,this.$axios.post("http://localhost:9000/task/insertTaskJKM",{title:this.taskInfo.name,description:e,groupid:this.route.params.id,publishtime:this.FormatTime(this.taskInfo.time[0]),endtime:this.FormatTime(this.taskInfo.time[1])}).then((e=>{"success"===e.data&&(this.$message.success("创建任务成功"),this.reload())})).catch((e=>{this.$message.error("出错了！"),console.log(e)}))},delMem(e,t){Object.keys(this.Mem).forEach((e=>{this.Mem[e]=t[e]})),this.$axios.post("http://localhost:9000/manage/delMember",{userid:this.Mem.userid,groupid:this.route.params.id}).then((e=>{"success"===e.data&&(p.success("成功删除"),this.reload())})).catch((e=>{this.$message.error("出错了！"),console.log(e)}))},disabledDate:e=>e.getTime()<=Date.now()}},g=m();e("data-v-0155abac");const f={slot:"header",class:"clearfix"},b={class:"box-title"},k={class:"text",style:{"margin-left":"50px"}},x=u("修改群内名称"),y=u("查看成员"),V=u("添加管理员"),_={style:{display:"none"}},w={style:{"font-size":"16px"}},I=u(" 查看 "),C={style:{display:"none"}},$={style:{"font-size":"16px"}},j=u(" 删除 "),v=u("立即创建"),z=u("取消"),M={style:{"font-size":"16px","margin-bottom":"20px"}},N={style:{"margin-left":"20px"}},S={class:"dialog-footer"},T=u("取 消"),D=u("提交");t();const L=g(((e,t,m,u,h,p)=>{const c=a("el-button"),L=a("el-table-column"),U=a("router-link"),q=a("el-table"),P=a("el-pagination"),F=a("el-card"),B=a("el-dialog"),E=a("el-input"),G=a("el-form-item"),H=a("el-option"),J=a("el-select"),O=a("el-date-picker"),K=a("el-form");return s(),l("div",null,[i(F,{class:"box-card"},{default:g((()=>[i("div",f,[i("span",b,o(h.groupName),1),i("span",k,"群组id："+o(h.groupID),1),i(c,{style:{float:"right","font-size":"16px"},type:"text",onClick:t[1]||(t[1]=e=>p.altername())},{default:g((()=>[x])),_:1}),i(c,{style:{float:"right","font-size":"16px","text-align":"center","padding-right":"30px"},type:"text",onClick:t[2]||(t[2]=e=>p.member())},{default:g((()=>[y])),_:1}),i(c,{style:{float:"right","font-size":"16px","padding-right":"30px","text-align":"center"},type:"text",onClick:t[3]||(t[3]=e=>p.addMan())},{default:g((()=>[V])),_:1})]),i(q,{"show-header":!1,data:h.taskList,style:{width:"100%"},"highlight-current-row":""},{default:g((()=>[i(L,{width:"10"},{default:g((e=>[i("span",_,o(e.row.taskid),1)])),_:1}),i(L,null,{default:g((e=>[i("div",w,o(e.row.title),1)])),_:1}),i(L,{width:"150",align:"center"},{default:g((e=>[i(U,{to:"/task/"+e.row.taskid},{default:g((()=>[i(c,{type:"primary",size:"small",style:{width:"100%"}},{default:g((()=>[I])),_:1})])),_:2},1032,["to"])])),_:1})])),_:1},8,["data"]),i(P,{onSizeChange:p.handleSizeChange,onCurrentChange:p.handlecurrentChange,"current-page":h.currentPage,layout:"total,prev, pager, next, jumper",total:h.totalCount,"hide-on-single-page":!1},null,8,["onSizeChange","onCurrentChange","current-page","total"])])),_:1}),i(B,{title:"成员列表",modelValue:h.memberVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>h.memberVisible=e)},{default:g((()=>[i(q,{data:h.memberList,"show-header":!1,"highlight-current-row":""},{default:g((()=>[i(L,{width:"10"},{default:g((e=>[i("span",C,o(e.row.userid),1)])),_:1}),i(L,null,{default:g((e=>[i("span",$,o(e.row.memname),1)])),_:1}),i(L,{width:"150",align:"center"},{default:g((e=>[i(c,{type:"danger",size:"small",style:{width:"100%"},onClick:t=>p.delMem(e.$index,e.row)},{default:g((()=>[j])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),i(c,{type:"primary",icon:"el-icon-plus",circle:"",class:"button",onClick:t[5]||(t[5]=e=>p.addTask())}),i(B,{title:"创建任务",modelValue:h.taskVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>h.taskVisible=e),width:"30%"},{default:g((()=>[i(K,{model:h.taskInfo,rules:h.rule},{default:g((()=>[i(G,{label:"任务名称",prop:"name"},{default:g((()=>[i(E,{modelValue:h.taskInfo.name,"onUpdate:modelValue":t[6]||(t[6]=e=>h.taskInfo.name=e)},null,8,["modelValue"])])),_:1}),i(G,{label:"任务模板",prop:"mode"},{default:g((()=>[i(J,{modelValue:h.taskInfo.mode,"onUpdate:modelValue":t[7]||(t[7]=e=>h.taskInfo.mode=e),placeholder:"请选择模板",style:{width:"100%"}},{default:g((()=>[i(H,{label:"健康码",value:"1"}),i(H,{label:"行程码",value:"2"}),i(H,{label:"其他",value:"3"})])),_:1},8,["modelValue"])])),_:1}),"3"==h.taskInfo.mode?(s(),l(G,{key:0,label:"识别文字",prop:"text"},{default:g((()=>[i(E,{modelValue:h.taskInfo.text,"onUpdate:modelValue":t[8]||(t[8]=e=>h.taskInfo.text=e),placeholder:"请输入所需文字"},null,8,["modelValue"])])),_:1})):r("",!0),i(G,{label:"开始时间",prop:"time"},{default:g((()=>[i(O,{modelValue:h.taskInfo.time,"onUpdate:modelValue":t[9]||(t[9]=e=>h.taskInfo.time=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},"disabled-date":p.disabledDate},null,8,["modelValue","disabled-date"])])),_:1}),i(G,null,{default:g((()=>[i(c,{type:"primary",onClick:t[10]||(t[10]=e=>p.onSubmit())},{default:g((()=>[v])),_:1}),i(c,null,{default:g((()=>[z])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),i(B,{title:"修改名称",modelValue:h.nameVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>h.nameVisible=e)},{footer:g((()=>[i("span",S,[i(c,{onClick:t[14]||(t[14]=e=>h.nameVisible=!1)},{default:g((()=>[T])),_:1}),i(c,{type:"primary",onClick:p.alter},{default:g((()=>[D])),_:1},8,["onClick"])])])),default:g((()=>[i(K,null,{default:g((()=>[i("div",M,[d(i("span",null,o(h.memName),513),[[n,!h.edit3]]),d(i(E,{type:"text",modelValue:h.memName,"onUpdate:modelValue":t[12]||(t[12]=e=>h.memName=e),style:{width:"150px"}},null,8,["modelValue"]),[[n,h.edit3]]),i("span",N,[i(c,{type:"primary",icon:{"el-icon-edit":!h.edit3,"el-icon-check":h.edit3},circle:"",size:"mini",onClick:t[13]||(t[13]=e=>h.edit3=!h.edit3)},null,8,["icon"])])])])),_:1})])),_:1},8,["modelValue"])])}));c.render=L,c.__scopeId="data-v-0155abac";export default c;
