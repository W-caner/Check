import{aj as t,ah as e,ao as s,ag as a,G as i,O as o,q as l,aI as r,aX as d,aJ as n,N as h}from"./@vue.c261c184.js";import{a as c}from"./vue-router.f985018f.js";import{_ as p}from"./vue-schart.5f39d935.js";import"./index.1b80984c.js";import{w as m}from"./element-plus.d6772035.js";import{t as u}from"./js-table2excel.4d00d137.js";import{h as g}from"./_html2canvas@1.4.1@html2canvas.0b7b60f5.js";import"./schart.js.36bd0dd2.js";import"./axios.df2521e5.js";import"./vuex.51c69487.js";import"./vue-i18n.298c823a.js";import"./@intlify.c1f614fa.js";import"./resize-observer-polyfill.96acbc9d.js";import"./lodash.c042e748.js";import"./normalize-wheel.86fce3c7.js";import"./mitt.20cc8481.js";import"./dayjs.1c7a45b9.js";import"./async-validator.3a3a8ce1.js";import"./@popperjs.59bfb2c1.js";const f={name:"Task",path:"/task/:id",inject:["reload"],components:{Schart:p},data:()=>({options3:{type:"pie",legend:{position:"left"},bgColor:"#fbfbfb",labels:["已通过","未通过","未填写"],datasets:[{data:[0,0,0]}]},route:c(),task:{taskname:"",starttime:"",endtime:"",isFinish:!1},memberList:[],isedit:!1,memberTitle:"",photo:{pUrl:"",pResult:"",pid:""},picture:{id:"",name:"",isFinish:!1,isPass:!1},edit1:!1,noticable:!0}),mounted(){this.$axios.get("http://localhost:9000/task/getTaskInfo",{params:{id:this.route.params.id}}).then((t=>{console.log(t.data),null!==t.data&&(this.task.taskname=t.data.title,this.task.description=t.data.description,this.task.starttime=t.data.publishtime,this.task.endtime=t.data.endtime,(t=>{var e=new Date;t=t.replace(/-/g,"/");var s=new Date(t);return console.log(e.getTime()),console.log(s.getTime()),!(e.getTime()>s.getTime())})(t.data.endtime)?(this.task.isFinish=!1,this.noticable=!0):(this.task.isFinish=!0,this.noticable=!1))})).catch((t=>{this.$message.error("出错了！"),console.log(t)})),this.$axios.get("http://localhost:9000/pic/getPicUnPass",{params:{id:this.route.params.id}}).then((t=>{this.options3.datasets[0].data[1]=t.data.length})).catch((t=>{this.$message.error("出错了！"),console.log(t)})),this.$axios.get("http://localhost:9000/pic/getPicUnFinish",{params:{id:this.route.params.id}}).then((t=>{console.log(this.options3.datasets[0].data[0]),this.options3.datasets[0].data[2]=t.data.length})).catch((t=>{this.$message.error("出错了！"),console.log(t)})),this.$axios.get("http://localhost:9000/pic/getPicPass",{params:{id:this.route.params.id}}).then((t=>{this.options3.datasets[0].data[0]=t.data.length})).catch((t=>{this.$message.error("出错了！"),console.log(t)})),this.$axios.get("http://localhost:9000/pic/getPic",{params:{id:this.route.params.id}}).then((t=>{for(let s=0;s<t.data.length;s++){var e={id:t.data[s].picid,name:t.data[s].memname,isFinish:!1,isPass:!1};"2"===t.data[s].result&&(e.isFinish=!0),"1"===t.data[s].result&&(e.isPass=!0),this.memberList.push(e)}})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))},watch:{$route(){this.reload()}},methods:{taskC(t,e){this.isedit=!0,Object.keys(this.picture).forEach((t=>{this.picture[t]=e[t]})),this.$axios.get("http://localhost:9000/pic/getPicD",{params:{id:this.picture.id}}).then((t=>{this.photo.pid=t.data.picid,"0"===t.data.result?this.photo.pResult="未通过":"1"===t.data.result&&(this.photo.pResult="已通过");let e=t.data.photo.split("\\");this.photo.pUrl="http://localhost:9000/pics/"+e[e.length-1]})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))},sub(){this.$axios.get("http://localhost:9000/pic/alterR",{params:{picid:this.photo.pid,result:"未通过"===this.photo.pResult?"0":"1"}}).then((t=>{"success"===t.data?(m.success("成功修改结果"),this.isedit=!1,this.reload()):(m.error("修改结果失败"),this.isedit=!1)})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))},notice(){this.$axios.get("http://localhost:9000/sendMess",{params:{tid:this.route.params.id}}).then((t=>{this.$message.success("成功提醒！")})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))},FormatTime(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},finish(){this.$confirm("是否现在结束该任务?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("http://localhost:9000/task/endTask",{taskid:this.route.params.id,endtime:this.FormatTime(Date.now())}).then((t=>{"success"===t.data?(m.success("任务已结束"),this.reload()):m.error("结束任务失败")})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))})).catch((()=>{}))},excel(){const t=[{title:"用户id",key:"userid",type:"text"},{title:"用户昵称",key:"memname",type:"text"},{title:"上传图片",key:"photo",type:"image"},{title:"识别结果",key:"result",type:"text"}];this.$axios.get("http://localhost:9000/task/getExcel",{params:{taskid:this.route.params.id}}).then((e=>{var s=[];for(let t=0;t<e.data.length;t++){let a={userid:"",memname:"",photo:"",result:""};a.userid=e.data[t].userid,a.memname=e.data[t].memname,a.photo=e.data[t].photo,"2"===e.data[t].result?a.result="未填写":"1"===e.data[t].result?a.result="已通过":a.result="未通过",s.push(a)}const a=this.task.taskname;u(t,s,a)})).catch((t=>{this.$message.error("出错了！"),console.log(t)}))},picturee(){let t=document.getElementById("picture");g(t).then((t=>{var e=t.toDataURL("image/jpeg",1),s=document.createElement("a");s.href=e,s.download=this.task.taskname,s.click()})).catch((t=>{console.log(t)}))}}},k=n();t("data-v-765240be");const x={class:"user-info"},y={class:"user-info-cont"},b={style:{"font-size":"25px",color:"#222","margin-bottom":"5px"}},v=h("结束"),w={class:"user-info-list"},j=h(" 开始时间： "),_={class:"user-info-list"},$=h(" 结束时间： "),F={class:"clearfix"},T=o("span",{style:{"font-size":"18px"}},"统计结果",-1),C=h("导出图表"),P={class:"clearfix"},z=o("span",{style:{"font-size":"18px"}},"完成情况",-1),U=h("通知未完成成员"),V=h("导出excel"),R={style:{display:"none"}},D=h(" 查看 "),I={style:{"font-size":"16px","margin-top":"10px"}},E=h(" 识别结果： "),L={style:{"margin-left":"20px"}},B={class:"dialog-footer"},M=h("取 消"),O=h("提交");e();const S=k(((t,e,n,h,c,p)=>{const m=s("el-button"),u=s("el-card"),g=s("schart"),f=s("el-col"),S=s("el-table-column"),q=s("el-checkbox"),G=s("el-table"),H=s("el-row"),J=s("el-option"),N=s("el-select"),X=s("el-form"),Y=s("el-dialog");return a(),i("div",null,[o(H,{gutter:20},{default:k((()=>[o(f,{span:8},{default:k((()=>[o(u,{style:{"margin-bottom":"20px"},shadow:"hover"},{default:k((()=>[o("div",x,[o("div",y,[o("div",null,[o("span",b,l(c.task.taskname),1),o(m,{type:"danger",onClick:e[1]||(e[1]=t=>p.finish()),size:"mini",style:{float:"right"},class:{isTfinish:c.task.isFinish}},{default:k((()=>[v])),_:1},8,["class"])])])]),o("div",w,[j,o("span",null,l(c.task.starttime),1)]),o("div",_,[$,o("span",null,l(c.task.endtime),1)])])),_:1}),o(u,{shadow:"hover"},{header:k((()=>[o("div",F,[T,o(m,{style:{float:"right",padding:"3px 0"},type:"text",onClick:e[2]||(e[2]=t=>p.picturee())},{default:k((()=>[C])),_:1})])])),default:k((()=>[o(g,{class:"schart",canvasId:"pie",options:c.options3,id:"picture"},null,8,["options"])])),_:1})])),_:1}),o(f,{span:16},{default:k((()=>[o(u,{shadow:"hover"},{header:k((()=>[o("div",P,[z,r(o(m,{style:{float:"right",padding:"3px 0"},type:"text",onClick:e[3]||(e[3]=t=>p.notice())},{default:k((()=>[U])),_:1},512),[[d,c.noticable]]),o(m,{style:{float:"right",padding:"3px 0","margin-right":"15px"},type:"text",onClick:e[4]||(e[4]=t=>p.excel())},{default:k((()=>[V])),_:1})])])),default:k((()=>[o(G,{"show-header":!1,data:c.memberList,style:{width:"100%"}},{default:k((()=>[o(S,{width:"1"},{default:k((t=>[o("span",R,l(t.row.id),1)])),_:1}),o(S,{width:"1"},{default:k((t=>[o(q,{modelValue:t.row.isFinish,"onUpdate:modelValue":e=>t.row.isFinish=e,style:{display:"none"}},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),o(S,null,{default:k((t=>[o("div",{style:{"font-size":"16px"},class:{isfinish:t.row.isPass}},l(t.row.name),3)])),_:1}),o(S,{width:"150",align:"center"},{default:k((t=>[o(m,{type:"primary",size:"small",style:{width:"100%"},onClick:e=>p.taskC(t.$index,t.row),disabled:t.row.isFinish},{default:k((()=>[D])),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1})])),_:1}),o(Y,{title:c.memberTitle,modelValue:c.isedit,"onUpdate:modelValue":e[9]||(e[9]=t=>c.isedit=t)},{footer:k((()=>[o("span",B,[o(m,{onClick:e[7]||(e[7]=t=>c.isedit=!1)},{default:k((()=>[M])),_:1}),o(m,{type:"primary",onClick:e[8]||(e[8]=t=>p.sub())},{default:k((()=>[O])),_:1})])])),default:k((()=>[o(X,null,{default:k((()=>[o("img",{src:c.photo.pUrl,style:{width:"100%"}},null,8,["src"]),o("div",I,[E,r(o("span",null,l(c.photo.pResult),513),[[d,!c.edit1]]),r(o(N,{type:"text",modelValue:c.photo.pResult,"onUpdate:modelValue":e[5]||(e[5]=t=>c.photo.pResult=t),style:{width:"150px"}},{default:k((()=>[o(J,{label:"未通过",value:"未通过"}),o(J,{label:"已通过",value:"已通过"})])),_:1},8,["modelValue"]),[[d,c.edit1]]),o("span",L,[o(m,{type:"primary",icon:{"el-icon-edit":!c.edit1,"el-icon-check":c.edit1},circle:"",size:"mini",onClick:e[6]||(e[6]=t=>c.edit1=!c.edit1)},null,8,["icon"])])])])),_:1})])),_:1},8,["title","modelValue"])])}));f.render=S,f.__scopeId="data-v-765240be";export default f;
