import{i as e,B as t,p as a,a as s,r as l,o as i,c as o,f as r,t as d,g as m,C as n,D as u,w as h,h as p}from"./vendor.d4ba3cb4.js";const c={name:"MGroup",path:"/manage/:id",inject:["reload"],data:()=>({memberVisible:!1,route:e(),groupName:"",groupID:"",taskList:[],memberList:[],Mem:{userid:"",memname:""},taskVisible:!1,taskInfo:{name:"",mode:"",time:"",text:""},nameVisible:!1,memName:"",edit3:!1,rule:{name:[{required:!0,trigger:"blur",message:"请输入任务名称"}],mode:[{required:!0,trigger:"blur",message:"请选择任务模式"}],text:[{required:!0,trigger:"blur",message:"请输入所需识别文字"}],time:[{required:!0,trigger:"blur",message:"请输入任务时间"}]}}),mounted(){this.groupID=this.route.params.id,this.$axios.get("http://localhost:9000/manage/getName",{params:{id:this.route.params.id}}).then((e=>{null!==e.data&&(this.groupName=e.data)})).catch((e=>{this.$message.error("出错了！")})),this.$axios.get("http://localhost:9000/manage/getTask",{params:{id:this.route.params.id}}).then((e=>{if(null!==e.data){this.taskList=[];for(let t=0;t<e.data.length;t++)this.taskList.push(e.data[t])}})).catch((e=>{this.$message.error("出错了！")}))},watch:{$route(){this.reload()}},methods:{FormatTime(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},altername(){this.$axios.get("http://localhost:9000/manage/altername",{params:{userid:localStorage.getItem("userId"),id:this.route.params.id}}).then((e=>{this.memName=e.data})).catch((e=>{this.$message.error("出错了！")})),this.nameVisible=!0},alter(){""!==this.memName?this.$axios.post("http://localhost:9000/manage/alter",{memname:this.memName,groupid:this.route.params.id,userid:localStorage.getItem("userId")}).then((e=>{"success"===e.data?t.success("成功修改名称"):t.error("修改名称出错")})).catch((e=>{this.$message.error("出错了！")})):t.error("群内昵称不能为空")},addTask(){this.taskVisible=!0},member(){this.$axios.get("http://localhost:9000/manage/getMember",{params:{id:this.route.params.id}}).then((e=>{if(null!==e.data){this.memberList=[];for(let t=0;t<e.data.length;t++)this.memberList.push(e.data[t])}})).catch((e=>{this.$message.error("出错了！")})),this.memberVisible=!0},addMan(){this.$prompt("请输入要添加管理员的id(电话)","创建管理员",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^1[3-9]\d{9}$/,inputErrorMessage:"管理员id格式不正确"}).then((({value:e})=>{this.$axios.post("http://localhost:9000/manage/addManager",{userid:e,groupid:this.route.params.id}).then((e=>{"success"===e.data&&(this.$message({type:"success",message:"添加管理员成功"}),this.reload())})).catch((e=>{t.error("出错了")}))})).catch((()=>{this.$message.error("添加管理员失败")}))},onSubmit(){var e="";e="3"===this.taskInfo.mode?this.taskInfo.text:this.taskInfo.mode,this.$axios.post("http://localhost:9000/task/insertTaskJKM",{title:this.taskInfo.name,description:e,groupid:this.route.params.id,publishtime:this.FormatTime(this.taskInfo.time[0]),endtime:this.FormatTime(this.taskInfo.time[1])}).then((e=>{})).catch((e=>{this.$message.error("出错了！")}))},delMem(e,a){Object.keys(this.Mem).forEach((e=>{this.Mem[e]=a[e]})),this.$axios.post("http://localhost:9000/manage/delMember",{userid:this.Mem.userid,groupid:this.route.params.id}).then((e=>{"success"===e.data&&(t.success("成功删除"),this.reload())})).catch((e=>{this.$message.error("出错了！")}))},disabledDate:e=>e.getTime()<=Date.now()}},g=h();a("data-v-70b672f0");const f={slot:"header",class:"clearfix"},b={class:"box-title"},k={class:"text",style:{"margin-left":"50px"}},x=p("修改群内名称"),y=p("查看成员"),V=p("添加管理员"),_={style:{display:"none"}},w={style:{"font-size":"16px"}},I=p(" 查看 "),$={style:{display:"none"}},M={style:{"font-size":"16px"}},v=p(" 删除 "),C=p("立即创建"),N=p("取消"),T={style:{"font-size":"16px","margin-bottom":"20px"}},z={style:{"margin-left":"20px"}},D={class:"dialog-footer"},L=p("取 消"),U=p("提交");s();const S=g(((e,t,a,s,h,p)=>{const c=l("el-button"),S=l("el-table-column"),q=l("router-link"),F=l("el-table"),j=l("el-card"),B=l("el-dialog"),E=l("el-input"),G=l("el-form-item"),H=l("el-option"),J=l("el-select"),K=l("el-date-picker"),O=l("el-form");return i(),o("div",null,[r(j,{class:"box-card"},{default:g((()=>[r("div",f,[r("span",b,d(h.groupName),1),r("span",k,"群组id："+d(h.groupID),1),r(c,{style:{float:"right","font-size":"16px"},type:"text",onClick:t[1]||(t[1]=e=>p.altername())},{default:g((()=>[x])),_:1}),r(c,{style:{float:"right","font-size":"16px","text-align":"center","padding-right":"30px"},type:"text",onClick:t[2]||(t[2]=e=>p.member())},{default:g((()=>[y])),_:1}),r(c,{style:{float:"right","font-size":"16px","padding-right":"30px","text-align":"center"},type:"text",onClick:t[3]||(t[3]=e=>p.addMan())},{default:g((()=>[V])),_:1})]),r(F,{"show-header":!1,data:h.taskList,style:{width:"100%"},"highlight-current-row":""},{default:g((()=>[r(S,{width:"10"},{default:g((e=>[r("span",_,d(e.row.taskid),1)])),_:1}),r(S,null,{default:g((e=>[r("div",w,d(e.row.title),1)])),_:1}),r(S,{width:"150",align:"center"},{default:g((e=>[r(q,{to:"/task/"+e.row.taskid},{default:g((()=>[r(c,{type:"primary",size:"small",style:{width:"100%"}},{default:g((()=>[I])),_:1})])),_:2},1032,["to"])])),_:1})])),_:1},8,["data"])])),_:1}),r(B,{title:"成员列表",modelValue:h.memberVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>h.memberVisible=e)},{default:g((()=>[r(F,{data:h.memberList,"show-header":!1,"highlight-current-row":""},{default:g((()=>[r(S,{width:"10"},{default:g((e=>[r("span",$,d(e.row.userid),1)])),_:1}),r(S,null,{default:g((e=>[r("span",M,d(e.row.memname),1)])),_:1}),r(S,{width:"150",align:"center"},{default:g((e=>[r(c,{type:"danger",size:"small",style:{width:"100%"},onClick:t=>p.delMem(e.$index,e.row)},{default:g((()=>[v])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),r(c,{type:"primary",icon:"el-icon-plus",circle:"",class:"button",onClick:t[5]||(t[5]=e=>p.addTask())}),r(B,{title:"创建任务",modelValue:h.taskVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>h.taskVisible=e),width:"30%"},{default:g((()=>[r(O,{model:h.taskInfo,rules:h.rule},{default:g((()=>[r(G,{label:"任务名称",prop:"name"},{default:g((()=>[r(E,{modelValue:h.taskInfo.name,"onUpdate:modelValue":t[6]||(t[6]=e=>h.taskInfo.name=e)},null,8,["modelValue"])])),_:1}),r(G,{label:"任务模板",prop:"mode"},{default:g((()=>[r(J,{modelValue:h.taskInfo.mode,"onUpdate:modelValue":t[7]||(t[7]=e=>h.taskInfo.mode=e),placeholder:"请选择模板",style:{width:"100%"}},{default:g((()=>[r(H,{label:"健康码",value:"1"}),r(H,{label:"行程码",value:"2"}),r(H,{label:"其他",value:"3"})])),_:1},8,["modelValue"])])),_:1}),"3"==h.taskInfo.mode?(i(),o(G,{key:0,label:"识别文字",prop:"text"},{default:g((()=>[r(E,{modelValue:h.taskInfo.text,"onUpdate:modelValue":t[8]||(t[8]=e=>h.taskInfo.text=e),placeholder:"请输入所需文字"},null,8,["modelValue"])])),_:1})):m("",!0),r(G,{label:"开始时间",prop:"time"},{default:g((()=>[r(K,{modelValue:h.taskInfo.time,"onUpdate:modelValue":t[9]||(t[9]=e=>h.taskInfo.time=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},"disabled-date":p.disabledDate},null,8,["modelValue","disabled-date"])])),_:1}),r(G,null,{default:g((()=>[r(c,{type:"primary",onClick:t[10]||(t[10]=e=>p.onSubmit())},{default:g((()=>[C])),_:1}),r(c,null,{default:g((()=>[N])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),r(B,{title:"修改名称",modelValue:h.nameVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>h.nameVisible=e)},{footer:g((()=>[r("span",D,[r(c,{onClick:t[14]||(t[14]=e=>h.nameVisible=!1)},{default:g((()=>[L])),_:1}),r(c,{type:"primary",onClick:p.alter},{default:g((()=>[U])),_:1},8,["onClick"])])])),default:g((()=>[r(O,null,{default:g((()=>[r("div",T,[n(r("span",null,d(h.memName),513),[[u,!h.edit3]]),n(r(E,{type:"text",modelValue:h.memName,"onUpdate:modelValue":t[12]||(t[12]=e=>h.memName=e),style:{width:"150px"}},null,8,["modelValue"]),[[u,h.edit3]]),r("span",z,[r(c,{type:"primary",icon:{"el-icon-edit":!h.edit3,"el-icon-check":h.edit3},circle:"",size:"mini",onClick:t[13]||(t[13]=e=>h.edit3=!h.edit3)},null,8,["icon"])])])])),_:1})])),_:1},8,["modelValue"])])}));c.render=S,c.__scopeId="data-v-70b672f0";export default c;
